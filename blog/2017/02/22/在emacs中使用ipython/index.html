<!DOCTYPE html>
<html lang="en-us">
<head>
  <title>在Emacs中使用Ipython - 陌上人如玉,公子世无双</title>
  <meta charset="utf-8" />
  <meta name="author" content="Samray" />
  <meta name="description" content="Use Ipython in Emasc" />
  <meta name="keywords" content="emacs,ipython" />

  <link rel="alternate" title="RSS Feed" href="/rss.xml" type="application/rss+xml">
  <link rel="stylesheet" href="/media/css/main.css" type="text/css">
  <link rel="stylesheet" href="/media/css/posts.css" type="text/css">
</head>

  <body class="container">
<header id="header">
<body>
    <nav class="navbar navbar-default navbar-fixed-top" style="opacity: .9" role="navigation">
        <div class="container-fluid">
<div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">陌上人如玉,公子世无双</a>
        </div>
<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li class="active"><a href="/">Blog</a></li>
          <li><a href="https://github.com/samrayleung">GitHub</a></li>
        </ul>
</div>
</div>
    </nav>
</body>
</header>

<section id="content" role="main">
    <div id="outline-container-sec-" class="row" style="padding-top: 70px">
        <div class="col-md-2"></div>
            <h1>在Emacs中使用Ipython</h1>
            
<div id="outline-container-org56cdb97" class="outline-2">
<h2 id="org56cdb97">Emacs Ipython 输出错误</h2>
<div class="outline-text-2" id="text-org56cdb97">
<p>
在Emacs 运行 <b>run-python</b> 的时候，报错了，如下
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">[?12l[?25h2+2
      [J[?7h[?12l[?25h[?2004l[?7hOut[1]: 4
</pre>
</div>
<p>
因为我的版本时Ipython5,查阅文档<a href="http://ipython.readthedocs.io/en/stable/whatsnew/version5.html#id1"><a href="http://ipython.readthedocs.io/en/stable/whatsnew/version5.html#id1">http://ipython.readthedocs.io/en/stable/whatsnew/version5.html#id1</a></a>
之后，发现Ipython5 有了新的terminal 接口，和Emacs 继承的shell 不兼容，所以
会出现上述的错误，只要给Ipython 加上运行参数就能解决了，所以只要在 <b>.emacs</b> 
或者对应的初始化文件加上下面语句
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(setq python-shell-interpreter "ipython"
      python-shell-interpreter-args "--simple-prompt -i")
</pre>
</div>
<hr />
</div>

<div id="outline-container-org8660347" class="outline-3">
<h3 id="org8660347">Update 2017-3-15</h3>
<div class="outline-text-3" id="text-org8660347">
<p>
在添加了 <b>--simple-promp -i</b> 参数以后，虽说乱码的问题解决了，但是新的问题又出现了
在Ipython 里面是没法无法输入多行内容的，即使是一个简单的循环，详情查看这条issue
<a href="https://github.com/ipython/ipython/issues/9816">https://github.com/ipython/ipython/issues/9816</a>. 现在Ipython 开发社区还没有解决这个
问题，所以现在的权宜之计就是使用 Ipython4,等到社区解决了这个问题在升级为 Ipython5
</p>
<div class="org-src-container">
<pre class="src src-shell">pip install --force-reinstall ipython==4.2.1
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org9652805" class="outline-2">
<h2 id="org9652805">Emacs Ipython 的使用优化</h2>
<div class="outline-text-2" id="text-org9652805">
</div><div id="outline-container-org79511d5" class="outline-3">
<h3 id="org79511d5">python-pop</h3>
<div class="outline-text-3" id="text-org79511d5">
<p>
因为我之前使用Emacs的时候，是使用Spacemacs的配置的，但是后来觉得还是自己的
配置用的更舒服，所以又切换回自己的配置，但是我还是很想念Spacemacs的一些绑定
例如shell在底下弹出，或者是关闭，然后找到了<a href="https://github.com/kyagi/shell-pop-el">Shell-pop</a> 这package,就可以用回
Spacemacs的shell使用习惯。然后我觉得，Ipython shell也可以这样配置，只不过
我没有发现类似的package,又因为Emacs Lisp的强大，所以我自己写了一段小函数实现
shell-pop 的功能
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(defun samray/python-pop ()
  "Run python and switch to the python buffer.
similar to shell-pop"
  (interactive)
  (if (get-buffer "*Python*")
      (if (string= (buffer-name) "*Python*")
	  (if (not (one-window-p))
	      (progn (bury-buffer)
		     (delete-window))
	    )
	(progn (switch-to-buffer-other-window "*Python*")
	       (end-of-buffer)
	       (evil-insert-state)))
    (progn
      (run-python)
      (switch-to-buffer-other-window "*Python*")
      (end-of-buffer)
      (evil-insert-state))))
</pre>
</div>
<p>
如果没有使用Evil,可以把 *(evil-insert-state)*去掉
</p>
</div>
</div>
<div id="outline-container-org6bb268e" class="outline-3">
<h3 id="org6bb268e">Ipython History</h3>
<div class="outline-text-3" id="text-org6bb268e">
<p>
我在普通的Shell使用Ipython的时候，很自然地使用上下方向键翻到上一条/下一条
执行的命令，因为shell的使用习惯就是这样滴，但是在Emacs里面使用Ipython,上下
方向键是去到上一行/下一行，就好像 vim 的 <b>j</b> <b>k</b>,如果要翻到上一条命令，快捷键
是 <b>M-p</b>,实在很不习惯，所以在查了一下Emacs manual 后，我改了一下按键绑定就实现了
我想要的效果
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(define-key comint-mode-map (kbd "&lt;up&gt;") 'comint-previous-input)
(define-key comint-mode-map (kbd "&lt;down&gt;") 'comint-next-input)
</pre>
</div>

<p>
Enjoy Emacs :)
</p>
</div>
</div>
</div>

    </div>
</section>


<footer id="footer">
    <br />
</footer>

  </body>
</html>
